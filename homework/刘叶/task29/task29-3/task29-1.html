<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>到达一定距离，出现回到顶部</title>
</head>
<style type="text/css">
    body,.content,ul,li,div{
        margin: 0;
        padding: 0;
        font-size: 16px;
        text-align: center;
        font-family: "Consolas", "Menlo", "Courier",monospace;
    }
    a{
        text-decoration: none;
    }
    li{
        list-style: none;
        background-color: lightblue;
    }
    .content{
        width: 800px;
        margin: 0 auto;
        text-align: center;
    }
    li{
        background-color: lightskyblue;
        margin: 30px 0;
        padding: 30px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.2s;
    }
    .active{
        color: #fff;
        background-color: cornflowerblue;
        transition: 0.5s;
    }
    .goTop{
        opacity: 0;
        position: fixed;
        color: #fff;
        right:8%;
        top:85%;
        height: 40px;
        width: 40px;
        line-height: 40px;
        border-radius: 50%;
        padding: 20px;
        transition: 0.3s;
        font-size: 20px;
        background-color:rgba(52, 52, 52, .4);
    }
    .goTop:hover{
        color: #fff;
        background-color:rgba(52, 52, 52, .8);
        transition: 0.5s;
    }
    .loading img{
        height: 20%;
        width: 20%;
        background-color: #00a0d8;
    }
</style>
<body>
    <div class="content">
        <div class="introduce"><h2>页面向下滑动加载发送Ajax加载更多,鼠标上去还能变色</h2></div>
        <ul class="infoCt">
            <li>内容01</li>
            <li>内容02</li>
            <li>内容03</li>
            <li>内容04</li>
            <li>内容05</li>
            <li>内容06</li>
            <li>内容07</li>
            <li>内容08</li>
            <li>内容09</li>
            <li>内容10</li>
        </ul>
        <div class="loadBtn">向下滑动加载更多</div>
    </div>
<script src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
    var $ct = $('.content'),
        $infoCt = $('.infoCt'),
        $loadBtn = $('.loadBtn');

    var $goTop =$('<a href="#" class="goTop">Top</a>');
        $goTop.appendTo($ct);

    //探测滑动距离,发送ajax的元素是否可见,是否到达需要显示goTop的位置
    $(window).on('scroll',function(){
        if( isVisible($loadBtn) ){
            sendAjax();
            $loadBtn.attr('isSend',true);
        }
        var scrollTop = $(window).scrollTop();
        if(scrollTop > 100){
            $goTop.css('opacity',1)
        }else{
            $goTop.css('opacity',0)
        }
    });

    //完成父容器事件代理,必须要给ajax回来添加的li再次绑定
    $infoCt.on('mouseover','li',function(){
        $(this).siblings().removeClass('active');
        $(this).addClass('active');
    });
    $infoCt.on('mouseleave','li',function(){
        $(this).removeClass('active');
    });

    //判定是否到可见
    function isVisible($node){
        var offsetTop = $node.offset().top,
                scrollTop = $(window).scrollTop(),
                windowH = $(window).height();
        if(scrollTop + windowH > offsetTop){
            return true
        }else{
            return false;
        }
    }

    //发送ajax,并给发送按钮加上状态锁,避免多次发送,并且改变样式
    function sendAjax(){
        if($(this).attr('isSend')){
            return;
        }
        var start = 10;
        $(this).html('<div class="loading"><img src="ajaxLoad.gif"></div>');
        $.ajax({
            url: 'getMore.php',
            dataType: 'json',
            type: 'GET',
            data: {
                start: start,
                len: 5
            },
            success: function (ret) {
                onSuccess(ret);
            },
            error: function () {
                onError();
            },
            complete: function () {
                onComplete();
            }
        });
        $(this).attr('isSend',false);
    }

    //ajax发送之后,具体的处理措施
    function onSuccess(ret) {
        if (ret.status === 1) {
            append(ret.data);
            start += 5;
        } else {
            alert('错误');
        }
    }

    function onError() {
        alert('服务器出错了!');
    }

    function onComplete() {
        $(this).html('<div class="loadBtn">向下滑动加载更多</div>');
    }

    function append(arr) {
        for (var i = 0; i < arr.length; i++) {
            $infoCt.append('<li>' + arr[i] + '</li>');
        }
    }

</script>
</body>
</html>